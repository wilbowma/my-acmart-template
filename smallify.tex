\LetLtxMacro{\oldsmall}{\small}
%\let\small=\relax

\newenvironment{nop}{\ifvmode\nointerlineskip\fi}{\ignorespacesafterend}

\LetLtxMacro{\oldmathpar}{\mathpar}
\LetLtxMacro{\oldendmathpar}{\endmathpar}

\LetLtxMacro{\olddisplaymath}{\displaymath}
\LetLtxMacro{\oldenddisplaymath}{\enddisplaymath}

\LetLtxMacro{\oldalign}{\align}
\LetLtxMacro{\oldendalign}{\endalign}

\LetLtxMacro{\oldfigure}{\figure}
\LetLtxMacro{\oldendfigure}{\endfigure}

\LetLtxMacro{\oldtable}{\table}
\LetLtxMacro{\oldendtable}{\endtable}

\LetLtxMacro{\oldcaption}{\caption}

\LetLtxMacro{\oldparagraph}{\paragraph}

\renewcommand{\paragraph}{\vspace{-\baselineskip}\vspace{1.5ex}\oldparagraph}

\renewenvironment{mathpar}{
\begin{nop}\small\oldmathpar}{
\oldendmathpar\end{nop}\ignorespacesafterend}

\renewenvironment{displaymath}{
\begin{nop}\small\olddisplaymath}{
\oldenddisplaymath\end{nop}\ignorespacesafterend}

\renewenvironment{align}{
\small\oldalign}{
\oldendalign\ignorespacesafterend}

\newcommand{\mycaption}[1]{
%
\vspace{-\baselineskip}%
\oldcaption{#1}%
}

\renewenvironment{figure}
{\let\caption=\mycaption\oldfigure}
{\vspace{-2ex}\oldendfigure}

\renewenvironment{table}
{\begin{nop}\small\oldtable}
{\vspace{-2ex}\oldendtable\end{nop}}

% TODO: Manually fixup
%\renewenvironment{figure*}
%{\let\caption=\mycaption\oldfigurestar}
%{\vspace{-2ex}\oldendfigurestar}

\LetLtxMacro{\oldrulename}{\rulename}

\renewcommand{\rulename}[1]{\oldrulename{\small #1}}

\LetLtxMacro{\oldtexttt}{\texttt}
\renewcommand{\texttt}[1]{\oldtexttt{\small #1}}

\renewcommand{\judgshape}[2][]{\begin{flushleft}\fbox{\({#2}\)}~{\small #1}\end{flushleft}}
